<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bus Search</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>

<style>
body{
  background:#f4f6f9;
}
.search-card{
  max-width:520px;
  border-radius:16px;
  background:#fff;
  border:1px solid #e6e6e6;
}
.input-box{
  position:relative;
}
.option-list{
  position:absolute;
  top:100%;
  width:100%;
  background:#fff;
  border:1px solid #dee2e6;
  border-radius:12px;
  margin-top:4px;
  max-height:180px;
  overflow-y:auto;
  z-index:100;
}
.option-list div{
  padding:8px 12px;
  cursor:pointer;
  font-size:14px;
}
.option-list div:hover{
  background:#f1f3f5;
}
.notfound{
  font-size:13px;
  color:#dc3545;
  margin-top:4px;
}
</style>
</head>

<body>
<div id="app" class="container py-5">

<h3 class="text-center fw-bold mb-4">Search Bus</h3>

<div class="search-card p-4 mx-auto">

  <!-- FROM -->
  <div class="mb-3 input-box">
    <label class="form-label">From</label>
    <input class="form-control"
      v-model="from"
      @input="searchStops('from')"
      placeholder="Enter starting point">

    <div class="option-list" v-if="showFromList">
      <div v-for="stop in filteredStops" @click="selectStop('from',stop)">
        {{ stop }}
      </div>
    </div>

    <div class="notfound" v-if="fromNotFound">
      Not found, try another
    </div>
  </div>

  <!-- TO -->
  <div class="mb-3 input-box">
    <label class="form-label">To</label>
    <input class="form-control"
      v-model="to"
      @input="searchStops('to')"
      placeholder="Enter destination">

    <div class="option-list" v-if="showToList">
      <div v-for="stop in filteredStops" @click="selectStop('to',stop)">
        {{ stop }}
      </div>
    </div>

    <div class="notfound" v-if="toNotFound">
      Not found, try another
    </div>
  </div>

  <!-- BUS NO -->
  <div class="mb-4">
    <label class="form-label">Bus No (optional)</label>
    <input class="form-control" v-model="busNo" placeholder="WB-XX-1234">
  </div>

  <button class="btn btn-primary w-100" @click="searchBus">
    <i class="bi bi-search"></i> Search
  </button>

</div>
</div>

<script>
Vue.createApp({
  data(){
    return{
      from:'',
      to:'',
      busNo:'',
      stops:[],
      filteredStops:[],
      showFromList:false,
      showToList:false,
      fromNotFound:false,
      toNotFound:false
    }
  },
  mounted(){
    fetch('buses.json')
      .then(res=>res.json())
      .then(data=>{
        let set=new Set();
        data.buses.forEach(bus=>{
          bus.stops.forEach(s=>set.add(s.name));
        });
        this.stops=[...set];
      });
  },
  methods:{
    searchStops(type){
      const value = (type==='from'?this.from:this.to).toLowerCase().trim();

      if(value.length < 1){
        this.showFromList = this.showToList = false;
        this.fromNotFound = this.toNotFound = false;
        return;
      }

      this.filteredStops = this.stops.filter(s =>
        s.toLowerCase().includes(value)
      );

      if(type==='from'){
        this.showFromList = true;
        this.fromNotFound = this.filteredStops.length === 0;
      }else{
        this.showToList = true;
        this.toNotFound = this.filteredStops.length === 0;
      }
    },

    selectStop(type,stop){
      if(type==='from'){
        this.from = stop;
        this.showFromList = false;
      }else{
        this.to = stop;
        this.showToList = false;
      }
    },

    searchBus(){
      if(this.busNo){
        location.href = `bus.html?busNo=${encodeURIComponent(this.busNo)}`;
      }
      else if(this.from && this.to){
        location.href = `results.html?from=${encodeURIComponent(this.from)}&to=${encodeURIComponent(this.to)}`;
      }
    }
  }
}).mount('#app');
</script>

</body>
</html>
