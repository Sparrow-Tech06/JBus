<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bus Results</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #ffffff ; }
    .bus-card { 
      border-radius: 12px; 
    /*  box-shadow: 0 2px 6px rgba(0,0,0,0.1); */
      margin-bottom: 20px; 
      padding: 15px;
      border: 2px solid #000 ;
    }
    .bus-image {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 10px;
    }
  </style>
</head>
<body class="container py-4">

  <h3 class="mb-4 text-center"> Available Buses </h3>
  <div id="results"></div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const from = params.get("from");
    const to = params.get("to");

    fetch("buses.json")
      .then(res => res.json())
      .then(data => {
        let buses = data.buses;

        // filter buses that include both stops in correct order
        buses = buses.filter(bus => {
          const stopNames = bus.stops.map(s => s.name.toLowerCase());
          const fromIndex = stopNames.indexOf(from.toLowerCase());
          const toIndex = stopNames.indexOf(to.toLowerCase());
          return fromIndex !== -1 && toIndex !== -1 && fromIndex < toIndex;
        });

        const resultsDiv = document.getElementById("results");
        if (buses.length === 0) {
          resultsDiv.innerHTML = `<p class="text-danger">No buses found for ${from} → ${to}</p>`;
          return;
        }

        resultsDiv.innerHTML = buses.map((bus, idx) => `
          <div class="bus-card d-flex align-items-start gap-3">
            <img src="${bus.image}" class="bus-image" alt="Bus Image" draggable="false">
            
            <div class="flex-grow-1">
              <h5 class="mb-2">${bus.name} (${bus.no})</h5>
              <p class="mb-2"><strong>${bus.from}</strong> → <strong>${bus.to}</strong></p>

              <div class="accordion" id="accordion${idx}">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${idx}">
                      View Route & Timings
                    </button>
                  </h2>
                  <div id="collapse${idx}" class="accordion-collapse collapse">
                    <div class="accordion-body">
                      <ul class="mb-0">
                        ${bus.stops.map(s => `<li><strong>${s.time}</strong> - ${s.name}</li>`).join("")}
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `).join("");
      });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
