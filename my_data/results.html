<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bus Results</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  
  <style>
    body { background: #ffffff; }
    .bus-card { 
      border-radius: 12px; 
      margin-bottom: 10px; 
      padding: 8px;
      border-bottom: 2px solid #F6F8FA;
    }
    .bus-image {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 10px;
    }
    .modal-fullscreen .modal-content {
      border-radius: 0;
    }
    .modal-title { font-size: 16px ; }
    .view-route {
       background-color: #3569b9;
       color: #fff;
       padding: 0.30rem 0.65rem;
       border-radius: 8px;
       margin: 0 auto;
       font-size: 14px ;
     }
    .view-route:hover {
       background-color: #3569b9 ;
       color: #fff ;
     }
    .modal-header {
      background: #3569b9 ;
      color: #ffffff ;
    }
    .road {
      text-align: center ;
      background: transparent ;
    }
    .from {
      background-color: #3569b9 ;
      color: #fff;
      padding: 4px 8px;
      border-radius: 6px;
    }
  .to {
      background-color: #687EFF;  /* blue shade */
      color: #fff;
      padding: 4px 8px;
      border-radius: 6px;
    }
    ul strong {
       background-color: rgba(53, 105, 185, 0.6);
       color: white;
       padding: 0.3rem 0.60rem;
       border-radius: 6px;
       margin-right: 10px;
       min-width: 60px;
       text-align: center;
       font-weight: 400;
       font-size: 15px ;
    }
   ul i { color: #3569b9 ; }
   .custom-close {
       filter: invert(54%) sepia(12%) saturate(600%) hue-rotate(130deg) brightness(95%) contrast(90%);
   }
    
  </style>
</head>
<body class="container py-4">

  <h3 class="mb-4 text-center">Available Buses</h3>
  <div id="results"></div>

  <!-- Modal Template -->
  <div class="modal fade" id="routeModal" tabindex="-1">
    <div class="modal-dialog modal-fullscreen">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="routeModalLabel"> </h5>
          <button type="button" class="btn-close custom-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="routeContent">
          <!-- Dynamic content will be injected here -->
        </div>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const from = params.get("from");
    const to = params.get("to");

    fetch("buses.json")
      .then(res => res.json())
      .then(data => {
        let buses = data.buses;

        buses = buses.filter(bus => {
          const stopNames = bus.stops.map(s => s.name.toLowerCase());
          const fromIndex = stopNames.indexOf(from.toLowerCase());
          const toIndex = stopNames.indexOf(to.toLowerCase());
          return fromIndex !== -1 && toIndex !== -1 && fromIndex < toIndex;
        });

        const resultsDiv = document.getElementById("results");
        if (buses.length === 0) {
          resultsDiv.innerHTML = `<p class="text-danger"> No buses found for ${from} → ${to}</p>`;
          return;
        }

        resultsDiv.innerHTML = buses.map((bus, idx) => `
          <div class="bus-card d-flex align-items-start gap-3">
            <img src="${bus.image}" class="bus-image" alt="Bus Image" draggable="false">
            <div class="flex-grow-1">
              <h6 class="mb-2">${bus.name} (${bus.no}) </h6>
              <p class="mb-2"> ${bus.from} → ${bus.to} </p>
              <button class="btn btn-sm view-route" data-idx="${idx}">View Route & Timings</button>
            </div>
          </div>
        `).join("");

        // Attach event listeners to buttons
        document.querySelectorAll(".view-route").forEach(btn => {
          btn.addEventListener("click", e => {
            const index = e.target.dataset.idx;
            const bus = buses[index];

            const routeList = bus.stops.map(s => `<li><strong>${s.time}</strong> - ${s.name}</li>`).join("");

            document.getElementById("routeModalLabel").innerText = `${bus.name} (${bus.no})`;
            document.getElementById("routeContent").innerHTML = `
              <p class="road"><strong class="from">${bus.from}</strong> → <strong class="to">${bus.to}</strong></p>
              <ul class="list-group">
                ${bus.stops.map(s => `<li class="list-group-item"><strong>${s.time}</strong> - <i class="bi bi-geo-alt-fill"></i> ${s.name}</li>`).join("")}
              </ul>
            `;

            const routeModal = new bootstrap.Modal(document.getElementById("routeModal"));
            routeModal.show();
          });
        });
      });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

