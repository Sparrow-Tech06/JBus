<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bus Search</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

<style>
body{
  background:#f4f6fb;
}
.card{
  border-radius:18px;
}
.notfound{
  font-size:13px;
  color:#dc3545;
}
</style>
</head>

<body class="d-flex justify-content-center align-items-center vh-100">

<div id="app" class="container">
  <h3 class="text-center mb-4">Search Bus</h3>

  <form @submit.prevent="search" class="card p-4 mx-auto" style="max-width:520px">

    <div class="mb-3">
      <label class="form-label">From</label>
      <input class="form-control" v-model="from" @input="filterStops" list="stops">
      <div v-if="fromNF" class="notfound">Not found, try another</div>
    </div>

    <div class="mb-3">
      <label class="form-label">To</label>
      <input class="form-control" v-model="to" @input="filterStops" list="stops">
      <div v-if="toNF" class="notfound">Not found, try another</div>
    </div>

    <div class="mb-3">
      <label class="form-label">Bus No (optional)</label>
      <input class="form-control" v-model="busNo">
    </div>

    <datalist id="stops">
      <option v-for="s in suggestions" :value="s"></option>
    </datalist>

    <button class="btn btn-primary w-100">Search</button>
  </form>
</div>

<script>
Vue.createApp({
  data(){
    return{
      buses:[],
      allStops:[],
      suggestions:[],
      from:'',
      to:'',
      busNo:'',
      fromNF:false,
      toNF:false
    }
  },
  mounted(){
    fetch('buses.json')
      .then(r=>r.json())
      .then(d=>{
        this.buses=d.buses;
        let set=new Set();
        d.buses.forEach(b=>{
          b.trips.forEach(t=>{
            t.stops.forEach(s=>set.add(s.name))
          })
        });
        this.allStops=[...set];
      });
  },
  methods:{
    filterStops(){
      let v=(this.from||this.to).toLowerCase();
      if(v.length<2){this.suggestions=[];return}
      this.suggestions=this.allStops.filter(s=>s.toLowerCase().includes(v));
      this.fromNF=this.from && !this.suggestions.includes(this.from);
      this.toNF=this.to && !this.suggestions.includes(this.to);
    },
    search(){
      if(this.busNo){
        location.href=`bus.html?busNo=${this.busNo}`;
      }else{
        location.href=`results.html?from=${this.from}&to=${this.to}`;
      }
    }
  }
}).mount('#app');
</script>
</body>
</html>
