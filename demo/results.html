<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bus Results</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>

<body class="bg-light p-3">

<div id="app" class="container">
  <h4 class="mb-3">Available Buses</h4>

  <div v-for="r in results" class="card mb-3">
    <img :src="r.image" class="card-img-top">
    <div class="card-body">
      <h5>{{r.busName}} ({{r.busNo}})</h5>
      <p>{{r.from}} â†’ {{r.to}}</p>

      <span v-if="!r.runToday" class="badge bg-danger">Bus Cancelled Today</span>
      <span v-else class="badge bg-success">Running</span>

      <a class="btn btn-sm btn-outline-primary mt-2"
         :href="`bus.html?busNo=${r.busNo}&trip=${r.tripId}`">
        View Details
      </a>
    </div>
  </div>
</div>

<script>
Vue.createApp({
  data(){return{results:[]}},
  mounted(){
    let p=new URLSearchParams(location.search);
    let from=p.get('from');
    let to=p.get('to');

    fetch('buses.json')
      .then(r=>r.json())
      .then(d=>{
        d.buses.forEach(b=>{
          b.trips.forEach(t=>{
            if(t.from===from && t.to===to){
              this.results.push({
                busNo:b.no,
                busName:b.name,
                image:b.image,
                tripId:t.id,
                ...t
              });
            }
          })
        })
      });
  }
}).mount('#app');
</script>
</body>
</html>
