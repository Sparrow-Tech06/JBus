<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bus Results</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #ffffff; }
    .bus-card { 
      border-radius: 12px; 
      margin-bottom: 20px; 
      padding: 15px;
      border: 1px solid #008080;
    }
    .bus-image {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 10px;
    }
    .modal-fullscreen .modal-content {
      border-radius: 0;
    }
  </style>
</head>
<body class="container py-4">

  <h3 class="mb-4 text-center">Available Buses</h3>
  <div id="results"></div>

  <!-- Modal Template -->
  <div class="modal fade" id="routeModal" tabindex="-1">
    <div class="modal-dialog modal-fullscreen">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="routeModalLabel">Route & Timings</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="routeContent">
          <!-- Dynamic content will be injected here -->
        </div>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const from = params.get("from");
    const to = params.get("to");

    fetch("buses.json")
      .then(res => res.json())
      .then(data => {
        let buses = data.buses;

        buses = buses.filter(bus => {
          const stopNames = bus.stops.map(s => s.name.toLowerCase());
          const fromIndex = stopNames.indexOf(from.toLowerCase());
          const toIndex = stopNames.indexOf(to.toLowerCase());
          return fromIndex !== -1 && toIndex !== -1 && fromIndex < toIndex;
        });

        const resultsDiv = document.getElementById("results");
        if (buses.length === 0) {
          resultsDiv.innerHTML = `<p class="text-danger">No buses found for ${from} → ${to}</p>`;
          return;
        }

        resultsDiv.innerHTML = buses.map((bus, idx) => `
          <div class="bus-card d-flex align-items-start gap-3">
            <img src="${bus.image}" class="bus-image" alt="Bus Image" draggable="false">
            <div class="flex-grow-1">
              <h5 class="mb-2">${bus.name} (${bus.no})</h5>
              <p class="mb-2"><strong>${bus.from}</strong> → <strong>${bus.to}</strong></p>
              <button class="btn btn-outline-teal btn-sm view-route" data-idx="${idx}">View Route & Timings</button>
            </div>
          </div>
        `).join("");

        // Attach event listeners to buttons
        document.querySelectorAll(".view-route").forEach(btn => {
          btn.addEventListener("click", e => {
            const index = e.target.dataset.idx;
            const bus = buses[index];

            const routeList = bus.stops.map(s => `<li><strong>${s.time}</strong> - ${s.name}</li>`).join("");

            document.getElementById("routeModalLabel").innerText = `${bus.name} (${bus.no}) - Route & Timings`;
            document.getElementById("routeContent").innerHTML = `
              <p><strong>${bus.from}</strong> → <strong>${bus.to}</strong></p>
              <ul class="list-group">
                ${bus.stops.map(s => `<li class="list-group-item"><strong>${s.time}</strong> - ${s.name}</li>`).join("")}
              </ul>
            `;

            const routeModal = new bootstrap.Modal(document.getElementById("routeModal"));
            routeModal.show();
          });
        });
      });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
