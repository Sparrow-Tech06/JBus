<!DOCTYPE html>
<html>
<head>
<title>Bus Search</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
.notfound{color:red;font-size:13px;display:none}
.small{font-size:14px}
</style>
</head>

<body class="container py-5">

<h3 class="text-center mb-4">Search Bus</h3>

<div id="spinner" class="text-center">
  <div class="spinner-border text-primary"></div>
</div>

<form id="form" class="card p-4 mx-auto d-none" style="max-width:500px">

<input id="from" class="form-control mb-2" placeholder="From">
<div id="fromText" class="small mb-2"></div>

<input id="to" class="form-control mb-2" placeholder="To">

<input id="busNo" class="form-control mb-3" placeholder="Bus No (optional)">

<button class="btn btn-primary w-100">Search</button>
</form>

<script>
let buses=[];

fetch("buses.json")
.then(r=>r.json())
.then(d=>{
  buses=d.buses;
  spinner.classList.add("d-none");
  form.classList.remove("d-none");
});

from.addEventListener("input",()=>{
  const val=from.value.toLowerCase();
  const list=buses.filter(b=>b.from.toLowerCase()==val);
  fromText.innerHTML=list.map(b=>
    b.isCancelled
    ? `<span class="text-danger">${b.no} (Not running today)</span>`
    : `<span class="text-success">${b.no}</span>`
  ).join(", ");
});

form.onsubmit=e=>{
  e.preventDefault();
  if(busNo.value)
    location=`bus.html?no=${busNo.value}`;
  else
    location=`results.html?from=${from.value}&to=${to.value}`;
};
</script>
</body>
</html>
